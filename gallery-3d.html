<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yanxu | 电影长廊</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>

    <style>
        /* === 1. 基础设置 === */
        :root {
            --bg-color: #0b0b0b; /* 电影院深黑 */
            --text-color: #e0e0e0;
            --accent-gold: #d4af37;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Songti SC", "Noto Serif SC", serif;
            overflow-x: hidden; /* 隐藏横向滚动条，用JS控制 */
        }

        /* 隐藏系统滚动条 */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* === 2. 加载页 (Opening Title) === */
        .intro-section {
            height: 100vh;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center;
            z-index: 10; relative;
        }
        .intro-title { font-size: 8vw; font-weight: 300; letter-spacing: 10px; margin: 0; opacity: 0; transform: translateY(50px); }
        .intro-subtitle { font-size: 1.5vw; color: #666; margin-top: 20px; letter-spacing: 5px; opacity: 0; }
        .scroll-hint { position: absolute; bottom: 50px; font-size: 12px; color: #444; animation: blink 2s infinite; }

        @keyframes blink { 50% { opacity: 0.3; } }

        /* === 3. 横向画廊容器 === */
        .gallery-wrapper {
            width: 400%; /* 宽度取决于图片数量，JS会自动计算，这里先给个大概 */
            height: 100vh;
            display: flex;
            flex-wrap: nowrap;
            will-change: transform; /* 性能优化 */
        }

        /* 单个画作容器 */
        .gallery-item {
            width: 60vw; /* 每张画占据屏幕 60% 宽 */
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-right: 5vw; /* 画与画的间距 */
            flex-shrink: 0;
        }

        /* 画框 */
        .art-card {
            position: relative;
            width: 100%; max-width: 800px;
            height: 70vh; /* 画框高度 */
            overflow: hidden; /* 关键：用于视差效果 */
            cursor: pointer;
            box-shadow: 0 20px 80px rgba(0,0,0,0.5);
            transition: transform 0.5s ease;
        }
        .art-card:hover { transform: scale(1.02); } /* 悬停微放大 */

        /* 画心 (图片) */
        .art-img {
            width: 120%; /* 关键：图片比框大，用于视差移动 */
            height: 100%;
            object-fit: cover;
            position: absolute;
            left: -10%; top: 0;
            will-change: transform;
        }

        /* 画作信息 (悬浮在左下角) */
        .art-info {
            position: absolute; bottom: -60px; left: 0;
            opacity: 0.6; transition: opacity 0.3s;
        }
        .gallery-item:hover .art-info { opacity: 1; }
        .art-title { font-size: 24px; margin: 0; letter-spacing: 2px; }
        .art-meta { font-size: 14px; color: #666; margin-top: 5px; font-family: sans-serif; }

        /* === 4. 进度条 (类似电影播放进度) === */
        .progress-bar {
            position: fixed; bottom: 0; left: 0; height: 4px; background: var(--accent-gold);
            width: 0%; z-index: 100;
        }

        /* === 5. 详情弹窗 (全屏覆盖) === */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 999;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .modal.active { opacity: 1; pointer-events: auto; }
        
        .modal-img { 
            max-height: 90vh; max-width: 90vw; 
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .close-btn {
            position: absolute; top: 30px; right: 30px;
            color: white; font-size: 30px; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.2);
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            transition: all 0.3s;
        }
        .close-btn:hover { background: white; color: black; transform: rotate(90deg); }

        /* 颗粒感滤镜 (Film Grain) - 增加电影质感 */
        .noise-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://assets.codepen.io/13471/noise.png');
            opacity: 0.05; pointer-events: none; z-index: 9999;
        }
    </style>
</head>
<body>

    <div class="noise-overlay"></div>
    <div class="progress-bar"></div>

    <div class="modal" id="detail-modal">
        <div class="close-btn" id="close-btn">✕</div>
        <img src="" alt="" class="modal-img" id="modal-img">
    </div>

    <section class="intro-section">
        <h1 class="intro-title">YANXU</h1>
        <p class="intro-subtitle">CHINESE PAINTING EXHIBITION</p>
        <div class="scroll-hint">SCROLL TO EXPLORE</div>
    </section>

    <div class="gallery-wrapper" id="gallery-wrapper">
        </div>

    <script>
        // === 1. 图片配置 (你可以把50张图都填这里) ===
        // 这里我写个循环生成 12 张图的逻辑，重复使用
        const artworks = [];
        const baseImages = 12; // 你有 eg1.jpg ~ eg12.jpg
        
        for(let i=1; i<=12; i++) {
            artworks.push({
                src: `assets/images/gallery/eg${i}.jpg`,
                title: `作品 No.${i}`,
                year: `202${i%5}`,
                size: "138x69cm"
            });
        }
        // 为了演示长廊，我们复制几倍数据
        const totalArtworks = [...artworks, ...artworks, ...artworks]; // 36张图

        // === 2. 动态生成 HTML ===
        const wrapper = document.getElementById('gallery-wrapper');
        
        // 重新计算容器宽度：每张图60vw + 间距5vw + 最后的留白
        wrapper.style.width = `${totalArtworks.length * 65 + 50}vw`;

        totalArtworks.forEach((art, index) => {
            const item = document.createElement('div');
            item.className = 'gallery-item';
            
            // 偶数图片稍微向下偏移，制造错落感
            const offset = index % 2 === 0 ? 'translateY(5vh)' : 'translateY(-5vh)';
            item.style.transform = offset;

            item.innerHTML = `
                <div class="art-card" onclick="openModal('${art.src}')">
                    <img src="${art.src}" class="art-img" alt="${art.title}">
                </div>
                <div class="art-info">
                    <h2 class="art-title">${art.title}</h2>
                    <p class="art-meta">${art.year} · ${art.size}</p>
                </div>
            `;
            wrapper.appendChild(item);
        });

        // === 3. 初始化动画 (GSAP + ScrollTrigger) ===
        gsap.registerPlugin(ScrollTrigger);

        // A. 开场文字动画
        const tl = gsap.timeline();
        tl.to(".intro-title", { opacity: 1, y: 0, duration: 1.5, ease: "power4.out" })
          .to(".intro-subtitle", { opacity: 1, duration: 1, delay: -1 });

        // B. 核心：将垂直滚动转换为水平滚动
        const sections = gsap.utils.toArray(".gallery-item");
        
        const scrollTween = gsap.to(sections, {
            xPercent: -100 * (sections.length - 1), // 向左移动所有图片的总长度
            ease: "none", // 匀速，由滚动条控制速度
            scrollTrigger: {
                trigger: ".gallery-wrapper",
                pin: true,   // 钉住页面，把垂直滚动变成水平动画
                scrub: 1,    // 1秒的平滑延迟，制造阻尼感
                // 滚动距离：为了让滚动不那么快，设为宽度的水平距离
                end: () => "+=" + document.querySelector(".gallery-wrapper").offsetWidth,
                // 更新进度条
                onUpdate: self => {
                    gsap.to(".progress-bar", { width: self.progress * 100 + "%", ease: "none", duration: 0.1 });
                }
            }
        });

        // C. 图片内部视差效果 (Parallax)
        // 让图片移动速度比框慢一点，产生“窗户”感
        sections.forEach((section) => {
            const img = section.querySelector(".art-img");
            gsap.to(img, {
                xPercent: 20, // 图片向右微移
                ease: "none",
                scrollTrigger: {
                    trigger: section,
                    containerAnimation: scrollTween, // 必须链接到主水平滚动
                    start: "left right",
                    end: "right left",
                    scrub: true
                }
            });
        });

        // === 4. Lenis 平滑滚动 (这是让网页有“高贵感”的关键) ===
        const lenis = new Lenis({
            duration: 1.2,
            easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
            orientation: 'vertical', 
            smoothWheel: true
        });

        function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
        }
        requestAnimationFrame(raf);

        // === 5. 弹窗逻辑 ===
        const modal = document.getElementById('detail-modal');
        const modalImg = document.getElementById('modal-img');
        const closeBtn = document.getElementById('close-btn');

        window.openModal = function(src) {
            modalImg.src = src;
            modal.classList.add('active');
            lenis.stop(); // 停止背景滚动
        };

        function closeModal() {
            modal.classList.remove('active');
            lenis.start(); // 恢复背景滚动
        }

        closeBtn.onclick = closeModal;
        modal.onclick = (e) => {
            if(e.target === modal) closeModal();
        };

    </script>
</body>
</html>
